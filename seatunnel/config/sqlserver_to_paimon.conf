env {
  execution.parallelism = 1
  job.mode = "STREAMING"
}

source {
  # 多表 CDC：按 SeaTunnel 2.3.12 文档配置
  SqlServer-CDC {
    base-url = "jdbc:sqlserver://mssql:1433;databaseName=ods"
    username = ${env.MSSQL_USER | "SA"}
    password = ${env.MSSQL_SA_PASSWORD}
    table-names = ["dbo.ods_customers", "dbo.ods_orders"]
    startup.mode = "initial"
  }
}

transform {
}

sink {
  # 多表写入 Paimon（MinIO 上的仓库）
  Paimon {
    catalog_name = "paimon_catalog"
    warehouse = "s3a://${env.PAIMON_BUCKET | "paimon-warehouse"}/warehouse"
    database = "ods"
    # 从源表名动态生成，结合映射去掉 schema 前缀
    table = "${table_name}"
    table-name-mapping = {
      "dbo.ods_customers" = "ods_customers"
      "dbo.ods_orders"    = "ods_orders"
    }
    # 依赖上游 CDC 提供主键信息；如需分区，可在表创建后调整
    hadoop_conf = {
      "fs.s3a.endpoint" = "http://minio:9000"
      "fs.s3a.access.key" = ${env.MINIO_ROOT_USER}
      "fs.s3a.secret.key" = ${env.MINIO_ROOT_PASSWORD}
      "fs.s3a.path.style.access" = "true"
    }
  }
}
